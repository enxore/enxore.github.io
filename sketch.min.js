function setProbRects(){push(),operatingArea.background(220);for(let i=0;i!=probRects.length;++i)probRects[i].display();mouseIsPressed?(vp1Defined=!0,operatingArea.rect(vp1.x,vp1.y,mouseX-vp1.x,mouseY-vp1.y),operatingArea.line(vp1.x,vp1.y,mouseX,mouseY),operatingArea.circle(vp1.x,vp1.y,10)):(vp1Defined&&(vp1Defined=!1,vp1.x!=mouseX&&vp1.y!=mouseY&&probRects.push(new MyRect(vp1,createVector(mouseX,mouseY)))),vp1=createVector(mouseX,mouseY)),operatingArea.circle(mouseX,mouseY,10),pop()}function preload(){let i=10,e=60,t=loadStrings("data/images/config.txt",()=>{for(;""==t[t.length-1];)t.pop();for(let e=0;e!=t.length;++e){let s=loadImage("data/images/"+t[e],()=>{s.resize(i,i)}),a=t[e].slice(0,t[e].lastIndexOf("."));images.set(a,s),displayed.set(a,!1)}}),s=loadStrings("data/backgrounds/config.txt",()=>{for(;""==s[s.length-1];)s.pop();backgroundElements.length=s.length;for(let i=0;i!=s.length;++i){let t=loadImage("data/backgrounds/"+s[i],()=>{t.resize(e,e)});backgroundElements[i]=t}})}function setImagesAppendix(i){for(let[e,t]of images.entries()){let s=createImage(t.width,t.height);s.copy(t,0,0,t.width,t.height,0,0,s.width,s.height),s.resize(i,i),imagesAppendix.set(e,s)}}function setup(){pageWidth=document.documentElement.scrollWidth,pageHeight=document.documentElement.scrollHeight,createCanvas(2*operatingAreaWidth,operatingAreaHeight),frameRate(60),operatingArea=createGraphics(operatingAreaWidth,operatingAreaHeight),background(255),setImagesAppendix(5),poemInput=createInput(),poemInput.position(0,operatingAreaHeight),poemInput.size(operatingAreaWidth,operatingAreaHeight/6),poemInput.input(poemInputEvent),setProbRectsFinished=!1,vp1Defined=!1,stage=0}function draw(){0==stage?(setProbRects(),setProbRectsFinished&&(operatingArea.clear(),clear(),++stage,frameRate(5))):1==stage&&elementDisplayer.initiallized&&!elementDisplayer.displayFinished&&elementDisplayer.displayNext(),clear(),image(operatingArea,0,0)}function poemInputEvent(){return!1}function keyPressed(){let i=()=>{clear(),iconDisplayer.clear();for(let i of displayed.keys())displayed.set(i,!1);bgDisplayer.clear(),elementDisplayer.clear()},e=()=>{let i=poemInput.value();for(let e=0;e!=i.length;++e){let t=i[e];if(images.has(t)&&!displayed.get(t)){let i,e;displayed.set(t,!0),i=images.get(t),e=imagesAppendix.get(t),iconDisplayer.addIconToList2(i,e,10,15)}}iconDisplayer.randomShuffle(),elementDisplayer.initiallize()},t=()=>{let i=40;do{let i=parseInt(random(backgroundElements.length));bgDisplayer.addImageToList(backgroundElements[i])}while(i-- >0);bgDisplayer.randomShuffle()};if(0==stage)keyCode==ENTER?setProbRectsFinished=!0:keyCode===BACKSPACE&&probRects.length&&probRects.pop();else if(1==stage)if(keyCode!==DELETE&&keyCode!=BACKSPACE||!iconDisplayer.displayList.length)keyCode==ENTER?(t(),e()):keyCode==TAB&&(i(),t(),e());else if(""==poemInput.value()){stage=0,clear(),operatingArea.push(),operatingArea.fill(255),operatingArea.stroke(0);for(let i=0;i!=probRects.length;++i)operatingArea.rect(probRects[i].vp0.x,probRects[i].vp0.y,probRects[i].size.x,probRects[i].size.y);operatingArea.pop()}else i()}let poemInput,operatingArea,images=new Map,imagesAppendix=new Map,displayed=new Map,backgroundElements=[],stage=0,operatingAreaWidth=600,operatingAreaHeight=600;class MyRect{constructor(i,e){let t=e.x-i.x,s=e.y-i.y,a=i.x,l=i.y;t<0&&(a+=t),s<0&&(l+=s),this.vp0=createVector(a,l),this.size=createVector(abs(t),abs(s))}display(){operatingArea.rect(this.vp0.x,this.vp0.y,this.size.x,this.size.y)}}class MyTriad{constructor(i,e,t){this.first=i,this.second=e,this.third=t}}let vp1,pageWidth,pageHeight,setProbRectsFinished=!1,probRects=[],vp1Defined=!1,elementDisplayer=new class{constructor(){this.displayList=[],this.displayFinished=!1,this.displayIndex=0,this.initiallized=!1}initiallize(){this.displayList.length=bgDisplayer.displayList.length+iconDisplayer.displayList.length;for(let i=0;i!=bgDisplayer.displayList.length;++i)this.displayList[i]=0;for(let i=bgDisplayer.displayList.length;i!=this.displayList.length;++i)this.displayList[i]=1;for(let i=this.displayList.length-1;i>0;i--){let e=Math.floor(Math.random()*(i+1));[this.displayList[i],this.displayList[e]]=[this.displayList[e],this.displayList[i]]}this.initiallized=!0}displayNext(){if(!this.initiallized)throw"The Displayer Object Has not initiallized.";if(this.displayFinished)throw"The Display Has Already Finished";this.displayList[this.displayIndex]?iconDisplayer.displayNext():bgDisplayer.displayNextImage(),++this.displayIndex,this.displayIndex==this.displayList.length&&(this.displayFinished=!0)}clear(){this.displayList=[],this.displayFinished=!1,this.displayIndex=0,this.initiallized=!1}};class MyDisplayer{constructor(){this.displayIndex=0,this.displayFinished=!1,this.displayList=[],this.displayType=[]}addIconToList(i,e){let t=20,s=[];s.length=t;for(let t=0;t!=s.length;++t)if(probRects.length&&Math.random()<.8){let i=parseInt(random(0,probRects.length));s[t]=createVector(probRects[i].vp0.x+random(probRects[i].size.x),probRects[i].vp0.y+random(probRects[i].size.y))}else s[t]=createVector(random(operatingAreaWidth-i.width*e),random(operatingAreaHeight-i.height*e));for(let t=0;t!=s.length;++t)this.displayList.push(new MyTriad(i,s[t],e))}addIconToList0(i,e){let t=5,s=[];s.length=t;for(let t=0;t!=s.length;++t)s[t]=createVector(random(operatingAreaWidth-i.width*e),random(operatingAreaHeight-i.height*e));for(let t=0;t!=s.length;++t)this.displayList.push(new MyTriad(i,s[t],e))}addImageToList(i){let e=5,t=[];t.length=e;for(let e=0;e!=t.length;++e)t[e]=createVector(random(operatingAreaWidth-i.width),random(operatingAreaHeight-i.height));for(let e=0;e!=t.length;++e)this.displayList.push(new MyTriad(i,t[e]))}addIconToList2(i,e,t,s){let a=10,l=[];l.length=a;for(let i=0;i!=l.length;++i)if(probRects.length&&Math.random()<.8){let e=parseInt(random(0,probRects.length));l[i]=createVector(probRects[e].vp0.x+random(probRects[e].size.x),probRects[e].vp0.y+random(probRects[e].size.y))}else l[i]=createVector(random(operatingAreaWidth),random(operatingAreaHeight));for(let a=0;a!=l.length;++a){let p=parseInt(2*Math.random()),r=[i,e][p],d=[t,s][p];l[a].x-=r.width*d/2,l[a].y-=r.width*d/2,this.displayList.push(new MyTriad(r,l[a],d))}}randomShuffle(){if(this.displayIndex)throw"Cannot Shuffle After Initialization.";for(let i=this.displayList.length-1;i>0;i--){let e=Math.floor(Math.random()*(i+1));[this.displayList[i],this.displayList[e]]=[this.displayList[e],this.displayList[i]]}}clear(){this.displayIndex=0,this.displayFinished=!1,this.displayList=[]}displayNext(){if(this.displayFinished)throw"The Display Has Already Finished";operatingArea.push(),this.displayList[this.displayIndex].first.loadPixels(),operatingArea.noStroke();for(let i=0;i<this.displayList[this.displayIndex].first.width;++i)for(let e=0;e<this.displayList[this.displayIndex].first.height;++e){let t=4*(i+e*this.displayList[this.displayIndex].first.width),s=this.displayList[this.displayIndex].first.pixels[t+0],a=this.displayList[this.displayIndex].first.pixels[t+1],l=this.displayList[this.displayIndex].first.pixels[t+2],p=this.displayList[this.displayIndex].first.pixels[t+3];operatingArea.fill(s,a,l,p),p>0&&operatingArea.rect(this.displayList[this.displayIndex].second.x+i*this.displayList[this.displayIndex].third,this.displayList[this.displayIndex].second.y+e*this.displayList[this.displayIndex].third,this.displayList[this.displayIndex].third,this.displayList[this.displayIndex].third)}operatingArea.pop(),++this.displayIndex,this.displayIndex==this.displayList.length&&(this.displayFinished=!0)}displayNextImage(){if(this.displayFinished)throw"The Display Has Already Finished";operatingArea.image(this.displayList[this.displayIndex].first,this.displayList[this.displayIndex].second.x,this.displayList[this.displayIndex].second.y),++this.displayIndex,this.displayIndex==this.displayList.length&&(this.displayFinished=!0)}displayAll(){operatingArea.push(),operatingArea.noStroke();for(let i=0;i!=this.displayList.length;++i){this.displayList[i].first.loadPixels();for(let e=0;e<this.displayList[i].first.width;++e)for(let t=0;t<this.displayList[i].first.height;++t){let s=4*(e+t*this.displayList[i].first.width),a=this.displayList[i].first.pixels[s+0],l=this.displayList[i].first.pixels[s+1],p=this.displayList[i].first.pixels[s+2],r=this.displayList[i].first.pixels[s+3];operatingArea.fill(a,l,p,r),r>0&&operatingArea.rect(this.displayList[i].second.x+e*this.displayList[i].third,this.displayList[i].second.y+t*this.displayList[i].third,this.displayList[i].third,this.displayList[i].third)}}operatingArea.pop(),this.displayFinished=!0}displayAllImages(){for(let i=0;i!=this.displayList.length;++i)operatingArea.image(this.displayList[i].first,this.displayList[i].second.x,this.displayList[i].second.y);this.displayFinished=!0}}let iconDisplayer=new MyDisplayer,bgDisplayer=new MyDisplayer;